## Set up a YubiKey for use with GPG and SSH

- Prepare a secure computer, preferrably a Tempest machine, by removing the harddisk and any network cable or USB devices.
- Boot the machine with a DVD generated from [livedeb](https://github.com/AminaBank/livedeb)
- Open a terminal
- Execute the following command, while replacing the UPPERCASE parts with your actual information. The last part "rsa4096" is only necessary if you intend to use the SSH key with outdated systems such as [Azure DevOps](https://developercommunity.visualstudio.com/t/Cant-use-ed25519-ssh-key/462263?q=Ed25519) 
  - /home/satoshi/gpg_yubi/gpg_yubikey.sh "SURNAME FAMILYNAME" NICKNAME SURNAME.FAMILYNAME@COMPANY.com rsa4096
- This generates a master key and three sub keys for encryption, signing and authentication
- The part where the private sub keys are moved to the card could not be scripted, and are thus interactive.
- Execute the following steps to move the signing sub key to the card:
  - type "key 1" to select the signing sub key
  - type "keytocard"
  - type "1" to select "Signature key"
  - if asked wheter to overwrite an existing key, answer with "y" and enter
  - When asked for the Admin PIN, enter "12345678"
  - type "key 1" to untoggle the signing sub key again
- Execute the following steps to move the authentication sub key to the card:
  - type "key 2" to select the signing sub key
  - type "keytocard"
  - type "3" to select "Authentication key"
  - if asked wheter to overwrite an existing key, answer with "y" and enter
  - When asked for the Admin PIN, enter "12345678"
  - type "key 2" to untoggle the signing sub key again
- Execute the following steps to move the encryption sub key to the card:
  - type "key 3" to select the encryption sub key
  - type "keytocard"
  - type "2" to select "Encryption key"
  - if asked wheter to overwrite an existing key, answer with "y" and enter
  - When asked for the Admin PIN, enter "12345678"
  - type "key 3" to untoggle the signing sub key again
- type "quit" to leave the interactive edit-key shell. When asked to save the changes, answer with "y" and enter.
- The part where the PIN and PUK are set could not be automated, and are thus interactive.
- Execute the following steps to change the PIN:
  - type "admin" and Enter
  - type "passwd and Enter
  - type "1" to select changing the PIN
  - type "123456" and Enter
  - enter a PIN of your choosing, which you can remember
  - enter the same PIN again
- Execute the following steps to change the PUK aka Admin PIN:
  - type "3" to select changing the PIN
  - type "12345678" and Enter
  - enter a PUK of your choosing, and write it down on a piece of paper.
  - enter the same PUK again
- type "Q" to leave the PIN menu.
- type "forcesig" to toggle the PIN requirement for signatures
- When asked for the Admin PIN, enter the PUK you just wrote on the paper. 
- type "quit" to leave the interactive card-edit shell.
- When asked for the Admin PIN, enter the PUK you just wrote on the paper. This will repeat 3 times
- When asked to disable touch policy, answer with "y". This can also happen 3 times.
- Insert and mount a USB stick.
- Copy the folder "/home/satoshi/Desktop/gnupg_temp" to the USB stick
- Unmount and remove the USB stick.
- Insert the USB stick together with the paper containing the PUK into a temper evident bag, and close it.
- Insert and mount a second USB stick.
- Copy the file "/home/satoshi/Desktop/gnupg_temp/public_NICKNAME.asc" to the USB stick
- Unmount and remove the USB stick.

## Set up the key on your work cmoputer

- Insert and mount the USB stick with the public key.
- Copy the public_*.asc file from the USB stick to your HOME directory. 
- Open a terminal, and type "gpg --import public_*.asc" and Enter. This will import the public keys.
- Unmount and remove the USB stick.
- Insert the YubiKey
- Type "gpg --card-status" in the terminal and Enter. This will create stubs for the private keys.
- Type "gpg --list-secret-keys" in the terminal and Enter. Make sure your keys are listed.
- 
